
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Frostmaiden Day Generator</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e3c72;
      color: #e0f7fa;
      text-align: center;
      padding: 2em;
      overflow: hidden;
      position: relative;
    }

    #snow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }

    .snowflake {
      position: absolute;
      top: -10px;
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
      animation: fall linear infinite;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh);
      }
    }

    button {
      font-size: 1rem;
      padding: 0.8em 1.5em;
      border: none;
      background-color: #00bcd4;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      margin: 0.5em;
    }

    pre {
      text-align: left;
      margin-top: 2em;
      background-color: rgba(255, 255, 255, 0.1);
      padding: 1em;
      border-radius: 1em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div id="snow"></div>

  <h1>ðŸ§Š Frostmaiden Day Generator</h1>
  <button onclick="generateDay()">Generate Day</button>

  <pre id="output"></pre>

  <script>
    let snowInterval = null;

    function roll(sides, times = 1) {
      let results = [];
      for (let i = 0; i < times; i++) {
        results.push(Math.floor(Math.random() * sides) + 1);
      }
      return times === 1 ? results[0] : results;
    }

    function resolveTime(period) {
      const timeMap = {
        morning: ["6am", "7am", "8am", "9am", "10am", "11am"],
        afternoon: ["12pm", "1pm", "2pm", "3pm", "4pm", "5pm"],
        evening: ["6pm", "7pm", "8pm", "9pm", "10pm", "11pm"],
        night: ["12am", "1am", "2am", "3am", "4am", "5am"]
      };
      return timeMap[period][roll(6) - 1];
    }

    function createSnowflake() {
      const snowflake = document.createElement("div");
      snowflake.classList.add("snowflake");
      snowflake.style.left = `${Math.random() * 100}vw`;
      snowflake.style.animationDuration = `${5 + Math.random() * 5}s`;
      snowflake.style.opacity = Math.random();
      snowflake.style.fontSize = `${Math.random() * 10 + 10}px`;
      document.getElementById("snow").appendChild(snowflake);
      setTimeout(() => snowflake.remove(), 10000);
    }

    function startSnow() {
      stopSnow();
      snowInterval = setInterval(createSnowflake, 200);
    }

    function stopSnow() {
      clearInterval(snowInterval);
      document.getElementById("snow").innerHTML = "";
    }

    function getDetailedEncounter(encounter, blizzard) {
      if (encounter === "Yeti" && !blizzard) return getBasicEncounter(true);
      if (encounter === "Yeti") {
        const yetiRoll = roll(6);
        if (yetiRoll <= 3) return `Yeti (${roll(4)})`;
        if (yetiRoll <= 5) return "Abominable Yeti";
        return "Yeti Tyke";
      }
      if (encounter === "Arveiaturace (ancient white dragon)") {
        return "Arveiaturace (ancient white dragon)";
      }
      // Add remaining encounter detail logic here as needed
      return encounter;
    }

    function getBasicEncounter(blizzard) {
      let rollResult;
      while (true) {
        rollResult = roll(20);
        if (rollResult === 1 && !blizzard) continue;
        if (rollResult === 20 && blizzard) continue;
        break;
      }

      const table = {
        1: "Yeti",
        2: "Goliath werebear",
        3: "Crag cats",
        4: "Coldlight walker",
        5: "Ice troll",
        6: "Frost druid and friends",
        7: "Chardalyn berserkers",
        8: "Frost giant riding a mammoth",
        9: "Battlehammer dwarves",
        10: "Arveiaturace (ancient white dragon)",
        11: "Snowy owlbear",
        12: "Gnolls",
        13: "Orcs of the Many-Arrows tribe",
        14: "Goliath party",
        15: "Chwinga",
        16: "Awakened beast",
        17: "Icewind kobolds",
        18: "Humans",
        19: "Herd of beasts",
        20: "Perytons"
      };

      return getDetailedEncounter(table[rollResult], blizzard);
    }

    function generateDay() {
      stopSnow(); // clear previous flakes

      const encounterRoll = roll(20);
      const weatherRoll = roll(20) + 1;
      const blizzard = weatherRoll > encounterRoll;

      const timeBlocks = ["morning", "afternoon", "evening", "night"];
      let blizzardTime = null;
      let blizzardDuration = null;
      if (blizzard) {
        const block = timeBlocks[roll(4) - 1];
        blizzardTime = `${resolveTime(block)} (${block})`;
        blizzardDuration = roll(4) + roll(4);
        startSnow(); // only start snow if it's a blizzard
      }

      let output = `ðŸŽ² Encounter d20: ${encounterRoll}\nðŸŒ¡ï¸ Weather d20+1: ${weatherRoll}\n`;
      output += blizzard
        ? `ðŸŒªï¸ Blizzard: YES\nðŸ•’ Start Time: ${blizzardTime}\nâ³ Duration: ${blizzardDuration} hours\n`
        : `ðŸŒªï¸ Blizzard: NO\n`;

      const d8 = roll(8);
      output += `\nâš”ï¸ Encounter Roll (d8): ${d8}\n`;

      if (d8 >= 1 && d8 <= 4) {
        const block = timeBlocks[d8 - 1];
        const hour = resolveTime(block);
        const encounter = getBasicEncounter(blizzard);
        output += `â€¢ ${hour} (${block}) â€” ${encounter}\n`;
      } else if (d8 <= 6) {
        const t1 = timeBlocks[roll(4) - 1];
        const t2 = timeBlocks[roll(4) - 1];
        let h1 = resolveTime(t1);
        let h2 = resolveTime(t2);
        while (t1 === t2 && h1 === h2) h2 = resolveTime(t2);
        const e1 = getBasicEncounter(blizzard);
        const e2 = getBasicEncounter(blizzard);
        output += `â€¢ ${h1} (${t1}) â€” ${e1}\n`;
        output += `â€¢ ${h2} (${t2}) â€” ${e2}\n`;
      } else {
        output += `â€¢ No encounters today.\n`;
      }

      document.getElementById("output").innerText = output;
    }
  </script>
</body>
</html>
